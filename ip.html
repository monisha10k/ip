<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Distance Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --bg-color: #f5f7fa;
            --card-bg: white;
            --text-color: var(--dark);
            --input-bg: white;
            --border-color: #e9ecef;
        }

        .dark-mode {
            --primary: #5e72e4;
            --secondary: #4a2dff;
            --accent: #ff3e9d;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #f0f0f0;
            --input-bg: #2d2d2d;
            --border-color: #444;
            --gray: #aaa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            position: relative;
        }

        h1 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .input-group {
            display: flex;
            margin-bottom: 1.5rem;
        }

        input {
            flex: 1;
            padding: 1rem;
            background: var(--input-bg);
            color: var(--text-color);
            border: 2px solid var(--border-color);
            border-radius: 8px 0 0 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }

        button:hover {
            background: var(--secondary);
        }

        .btn-accent {
            background: var(--accent);
            width: 100%;
            margin-top: 1.5rem;
        }

        .btn-accent:hover {
            background: #d1166b;
        }

        #map, #user-map, #route-map {
            height: 400px;
            border-radius: 8px;
            margin-top: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .info-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .info-item {
            background: var(--input-bg);
            padding: 1rem;
            border-radius: 8px;
        }

        .info-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1.2rem;
            font-weight: 500;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .distance-result {
            text-align: center;
            margin: 1.5rem 0;
            font-size: 1.5rem;
            font-weight: 500;
            display: flex;
            justify-content: center;
            gap: 2rem;
        }

        .time-badge {
            display: inline-flex;
            align-items: center;
            background: var(--accent);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-size: 1rem;
        }

        .security-panel {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 8px;
            border-left: 4px solid #f44336;
        }

        .security-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .security-header h3 {
            color: #f44336;
            margin-left: 0.5rem;
        }

        .security-icon {
            font-size: 1.5rem;
            color: #f44336;
        }

        .threat-heatmap {
            height: 200px;
            background: linear-gradient(135deg, #ffeb3b, #f44336);
            border-radius: 8px;
            margin-top: 1rem;
            position: relative;
            overflow: hidden;
        }

        .heatmap-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at var(--x) var(--y), transparent 20%, rgba(0,0,0,0.7) 100%);
        }

        .ai-verification {
            display: flex;
            align-items: center;
            margin-top: 1rem;
            padding: 0.5rem;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .ai-verification.risky {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
        }

        .ai-icon {
            font-size: 1.2rem;
            margin-right: 0.5rem;
            color: #4CAF50;
        }

        .ai-verification.risky .ai-icon {
            color: #f44336;
        }

        .network-speed-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            width: 160px;
            border: 1px solid #e0e0e0;
        }

        .dark-mode .network-speed-display {
            background: rgba(30, 30, 30, 0.9);
            border-color: #444;
        }

        .speed-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 0.25rem;
        }

        .speed-value {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .speed-meter {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .speed-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s;
        }

        .linkedin-profile {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5rem 0.75rem;
            border-radius: 30px;
            text-decoration: none;
            color: #0A66C2;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: all 0.3s;
        }

        .dark-mode .linkedin-profile {
            background: rgba(30, 30, 30, 0.9);
            color: #70B5F9;
        }

        .linkedin-profile:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }

        .linkedin-profile img {
            width: 24px;
            height: 24px;
            margin-right: 0.5rem;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body>
    <div class="network-speed-display">
        <div class="speed-label">Network Speed</div>
        <div class="speed-value" id="realtime-speed">Testing...</div>
        <div class="speed-meter">
            <div class="speed-bar" id="realtime-speed-bar"></div>
        </div>
    </div>

    <a href="https://www.linkedin.com/in/manisankar-k-143551230" class="linkedin-profile" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/174/174857.png" alt="LinkedIn">
        <span>Manisankar</span>
    </a>

    <div class="container">
        <!-- Step 1: Enter IP Address -->
        <div class="card step active" id="step1">
            <h1>Enter IP Address</h1>
            <div class="input-group">
                <input type="text" id="ip-input" placeholder="e.g. 8.8.8.8 or google.com">
                <button id="lookup-ip">Lookup</button>
            </div>
        </div>
       
        <!-- Step 2: Show IP Location -->
        <div class="card step" id="step2">
            <button class="back-button" id="back-to-ip1"><i class="fas fa-arrow-left"></i></button>
            <h1>IP Location Found</h1>
            <div id="map"></div>
           
            <div class="security-panel">
                <div class="security-header">
                    <span class="security-icon"><i class="fas fa-shield-alt"></i></span>
                    <h3>Security Analysis</h3>
                </div>
                <div class="threat-heatmap" id="threat-heatmap">
                    <div class="heatmap-overlay" id="heatmap-overlay"></div>
                </div>
                <div class="ai-verification" id="ai-verification">
                    <span class="ai-icon"><i class="fas fa-robot"></i></span>
                    <div>
                        <strong>AI Verification:</strong>
                        <span id="verification-text">Analyzing IP reputation...</span>
                    </div>
                </div>
            </div>
           
            <div class="info-card">
                <div class="info-item">
                    <div class="info-label">IP Address</div>
                    <div class="info-value" id="ip-address">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Location</div>
                    <div class="info-value" id="ip-location">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">ISP</div>
                    <div class="info-value" id="ip-isp">-</div>
                </div>
            </div>
            <button class="btn-accent" id="find-distance">Find Distance From Me</button>
        </div>
       
        <!-- Step 3: Enter User Location -->
        <div class="card step" id="step3">
            <button class="back-button" id="back-to-ip2"><i class="fas fa-arrow-left"></i></button>
            <h1>Enter Your Location</h1>
            <div class="input-group">
                <input type="text" id="user-location" placeholder="Enter your address or city">
                <button id="submit-location">Continue</button>
            </div>
            <div id="user-map"></div>
        </div>
       
        <!-- Step 4: Show Distance Results -->
        <div class="card step" id="step4">
            <button class="back-button" id="back-to-ip3"><i class="fas fa-arrow-left"></i></button>
            <h1>Distance Calculation</h1>
            <div id="route-map"></div>
            <div class="distance-result">
                <div>Distance: <span id="distance-value">-</span> km</div>
                <div class="time-badge">Time: <span id="time-value">-</span></div>
            </div>
            <div class="info-card">
                <div class="info-item">
                    <div class="info-label">Your Location</div>
                    <div class="info-value" id="user-location-display">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">IP Location</div>
                    <div class="info-value" id="ip-location-display">-</div>
                </div>
            </div>
            <button class="btn-accent" id="new-search">Start New Search</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"></script>
    <script>
        // Mapbox Access Token
        const MAPBOX_TOKEN = 'pk.eyJ1Ijoia2V2ZXRpaDg2MSIsImEiOiJja2h4MzFxaG8wOW5pMzBsdGZ1NXFoeHh5In0.hw5mLyF4KWalDgcxAWrmuw';

        // DOM Elements
        const steps = document.querySelectorAll('.step');
        const ipInput = document.getElementById('ip-input');
        const lookupBtn = document.getElementById('lookup-ip');
        const findDistanceBtn = document.getElementById('find-distance');
        const userLocationInput = document.getElementById('user-location');
        const submitLocationBtn = document.getElementById('submit-location');
        const newSearchBtn = document.getElementById('new-search');
        const backToIp1Btn = document.getElementById('back-to-ip1');
        const backToIp2Btn = document.getElementById('back-to-ip2');
        const backToIp3Btn = document.getElementById('back-to-ip3');

        // Network Speed Elements
        const realtimeSpeed = document.getElementById('realtime-speed');
        const realtimeSpeedBar = document.getElementById('realtime-speed-bar');

        // Info Display Elements
        const ipAddressEl = document.getElementById('ip-address');
        const ipLocationEl = document.getElementById('ip-location');
        const ipIspEl = document.getElementById('ip-isp');
        const distanceValueEl = document.getElementById('distance-value');
        const timeValueEl = document.getElementById('time-value');
        const userLocationDisplay = document.getElementById('user-location-display');
        const ipLocationDisplay = document.getElementById('ip-location-display');

        // Security Elements
        const threatHeatmap = document.getElementById('threat-heatmap');
        const heatmapOverlay = document.getElementById('heatmap-overlay');
        const aiVerification = document.getElementById('ai-verification');
        const verificationText = document.getElementById('verification-text');

        // Map Elements
        const ipMap = L.map('map');
        const userMap = L.map('user-map');
        const routeMap = L.map('route-map');

        // Data Storage
        let ipLocationData = null;
        let userLocationData = null;
        let routeLine = null;
        let speedTestInterval = null;
        let speedTestHistory = [];
        const HISTORY_SIZE = 5;

        // Initialize maps with Mapbox tiles
        function initMap(mapInstance) {
            L.tileLayer(`https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/{z}/{x}/{y}?access_token=${MAPBOX_TOKEN}`, {
                attribution: 'Â© Mapbox',
                maxZoom: 18
            }).addTo(mapInstance);
            return mapInstance;
        }

        // Initialize all maps
        initMap(ipMap);
        initMap(userMap);
        initMap(routeMap);

        // Change step
        function goToStep(stepNumber) {
            steps.forEach((step, index) => {
                step.classList.toggle('active', index === stepNumber - 1);
            });
        }

        // Network Speed Measurement Functions
        async function measureNetworkSpeed() {
            try {
                // Use a small image for measurement (better than random numbers)
                const testFileUrl = 'https://httpbin.org/image/jpeg';
                const fileSize = 102400; // 100KB test file
                const cacheBuster = `?cache_bust=${Date.now()}`;
               
                const startTime = performance.now();
                const response = await fetch(`${testFileUrl}${cacheBuster}`);
                const blob = await response.blob();
                const endTime = performance.now();
               
                // Calculate speed in bits per second
                const durationSeconds = (endTime - startTime) / 1000;
                const bitsLoaded = blob.size * 8;
                const speedBps = bitsLoaded / durationSeconds;
               
                return speedBps;
            } catch (error) {
                console.error('Speed test failed:', error);
                return 0;
            }
        }

        function formatSpeed(bps) {
            if (bps < 1000) return `${bps.toFixed(0)} bps`;
            if (bps < 1000000) return `${(bps / 1000).toFixed(1)} kbps`;
            return `${(bps / 1000000).toFixed(1)} Mbps`;
        }

        function startRealtimeSpeedTest() {
            if (speedTestInterval) clearInterval(speedTestInterval);
           
            speedTestInterval = setInterval(async () => {
                const speedBps = await measureNetworkSpeed();
                speedTestHistory.push(speedBps);
               
                if (speedTestHistory.length > HISTORY_SIZE) {
                    speedTestHistory.shift();
                }
               
                // Use median for more stable results
                const sortedSpeeds = [...speedTestHistory].sort((a, b) => a - b);
                const medianSpeed = sortedSpeeds[Math.floor(sortedSpeeds.length / 2)];
               
                // Update display
                const formattedSpeed = formatSpeed(medianSpeed);
                realtimeSpeed.textContent = formattedSpeed;
               
                // Calculate percentage for bar (cap at 50Mbps for display)
                const maxDisplaySpeed = 50 * 1000000; // 50Mbps
                const speedPercentage = Math.min(100, (medianSpeed / maxDisplaySpeed) * 100);
                realtimeSpeedBar.style.width = `${speedPercentage}%`;
               
                // Update color based on real-world standards
                if (medianSpeed < 256000) { // < 256kbps
                    realtimeSpeedBar.style.background = '#f44336'; // Red
                } else if (medianSpeed < 2000000) { // < 2Mbps
                    realtimeSpeedBar.style.background = '#ff9800'; // Orange
                } else if (medianSpeed < 10000000) { // < 10Mbps
                    realtimeSpeedBar.style.background = '#FFEB3B'; // Yellow
                } else {
                    realtimeSpeedBar.style.background = '#4CAF50'; // Green
                }
            }, 5000); // Test every 5 seconds
        }

        // Update threat heatmap based on mouse movement
        threatHeatmap.addEventListener('mousemove', (e) => {
            const rect = threatHeatmap.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            heatmapOverlay.style.setProperty('--x', `${x}px`);
            heatmapOverlay.style.setProperty('--y', `${y}px`);
        });

        // Simulate AI verification
        function performAIVerification(ip) {
            setTimeout(() => {
                const riskScore = Math.random();
               
                if (riskScore > 0.7) {
                    verificationText.textContent = "High risk! Malicious activity detected.";
                    aiVerification.classList.add('risky');
                } else if (riskScore > 0.3) {
                    verificationText.textContent = "Moderate risk. Exercise caution.";
                    aiVerification.classList.add('risky');
                } else {
                    verificationText.textContent = "Verified safe. No known threats.";
                    aiVerification.classList.remove('risky');
                }
            }, 1500);
        }

        // Lookup IP Address
        lookupBtn.addEventListener('click', async () => {
            const ip = ipInput.value.trim();
            if (!ip) return;
           
            try {
                // Reset security UI
                verificationText.textContent = "Analyzing IP reputation...";
                aiVerification.classList.remove('risky');
               
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                ipLocationData = await response.json();
               
                if (ipLocationData.error) throw new Error(ipLocationData.reason || 'Invalid IP address');
               
                // Update UI
                ipAddressEl.textContent = ipLocationData.ip || ip;
                ipLocationEl.textContent = `${ipLocationData.city || 'Unknown'}, ${ipLocationData.region || 'Unknown'}, ${ipLocationData.country_name || 'Unknown'}`;
                ipIspEl.textContent = ipLocationData.org || 'Unknown';
               
                // Update map
                ipMap.setView([ipLocationData.latitude, ipLocationData.longitude], 13);
                L.marker([ipLocationData.latitude, ipLocationData.longitude], {
                    icon: L.icon({
                        iconUrl: 'https://cdn-icons-png.flaticon.com/512/484/484167.png',
                        iconSize: [32, 32]
                    })
                }).addTo(ipMap)
                .bindPopup(`<b>${ipLocationData.ip}</b><br>${ipLocationData.city}, ${ipLocationData.country_name}`);
               
                // Perform security checks
                performAIVerification(ip);
               
                goToStep(2);
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        });

        // Navigation buttons
        findDistanceBtn.addEventListener('click', () => goToStep(3));
        backToIp1Btn.addEventListener('click', () => goToStep(1));
        backToIp2Btn.addEventListener('click', () => goToStep(2));
        backToIp3Btn.addEventListener('click', () => goToStep(3));
        newSearchBtn.addEventListener('click', () => {
            ipInput.value = '';
            userLocationInput.value = '';
            goToStep(1);
        });

        // Geocode User Location
        submitLocationBtn.addEventListener('click', async () => {
            const location = userLocationInput.value.trim();
            if (!location) return;
           
            try {
                const response = await fetch(
                    `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(location)}.json?access_token=${MAPBOX_TOKEN}`
                );
                const data = await response.json();
               
                if (!data.features?.length) throw new Error('Location not found');
               
                const [lng, lat] = data.features[0].center;
                userLocationData = {
                    lat,
                    lng,
                    name: data.features[0].place_name
                };
               
                // Update map
                userMap.setView([lat, lng], 13);
                L.marker([lat, lng], {
                    icon: L.icon({
                        iconUrl: 'https://cdn-icons-png.flaticon.com/512/447/447031.png',
                        iconSize: [32, 32]
                    })
                }).addTo(userMap)
                .bindPopup(`<b>Your Location</b><br>${userLocationData.name}`);
               
                calculateRoute();
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        });

        // Calculate Route Between Locations
        async function calculateRoute() {
            if (!ipLocationData || !userLocationData) return;
           
            try {
                distanceValueEl.textContent = 'Calculating...';
                timeValueEl.textContent = 'Calculating...';
                goToStep(4);
               
                // Update displays
                userLocationDisplay.textContent = userLocationData.name;
                ipLocationDisplay.textContent = `${ipLocationData.city}, ${ipLocationData.region}, ${ipLocationData.country_name}`;
               
                // Clear previous route if exists
                if (routeLine) routeMap.removeLayer(routeLine);
               
                // Set initial view
                routeMap.setView([
                    (userLocationData.lat + ipLocationData.latitude) / 2,
                    (userLocationData.lng + ipLocationData.longitude) / 2
                ], 8);
               
                // Add markers
                L.marker([userLocationData.lat, userLocationData.lng], {
                    icon: L.icon({
                        iconUrl: 'https://cdn-icons-png.flaticon.com/512/447/447031.png',
                        iconSize: [32, 32]
                    })
                }).addTo(routeMap)
                .bindPopup(`<b>Your Location</b><br>${userLocationData.name}`);
               
                L.marker([ipLocationData.latitude, ipLocationData.longitude], {
                    icon: L.icon({
                        iconUrl: 'https://cdn-icons-png.flaticon.com/512/484/484167.png',
                        iconSize: [32, 32]
                    })
                }).addTo(routeMap)
                .bindPopup(`<b>${ipLocationData.ip}</b><br>${ipLocationData.city}, ${ipLocationData.country_name}`);
               
                // Get route data
                const response = await fetch(
                    `https://api.mapbox.com/directions/v5/mapbox/driving/` +
                    `${userLocationData.lng},${userLocationData.lat};${ipLocationData.longitude},${ipLocationData.latitude}` +
                    `?geometries=geojson&overview=simplified&access_token=${MAPBOX_TOKEN}`
                );
                const routeData = await response.json();
               
                if (!routeData.routes?.length) throw new Error('No route found');
               
                const route = routeData.routes[0];
                const distanceKm = (route.distance / 1000).toFixed(1);
                const durationMinutes = Math.round(route.duration / 60);
               
                // Display results
                distanceValueEl.textContent = distanceKm;
                timeValueEl.textContent = durationMinutes < 60 ?
                    `${durationMinutes} min` :
                    `${Math.floor(durationMinutes / 60)}h ${durationMinutes % 60}m`;
               
                // Draw the route line
                routeLine = L.geoJSON(route.geometry, {
                    style: {
                        color: '#3a86ff',
                        weight: 4,
                        opacity: 0.7
                    }
                }).addTo(routeMap);
               
                // Fit bounds to show entire route
                routeMap.fitBounds([
                    [userLocationData.lat, userLocationData.lng],
                    [ipLocationData.latitude, ipLocationData.longitude]
                ], { padding: [50, 50] });
               
            } catch (error) {
                console.error('Routing error:', error);
                distanceValueEl.textContent = 'Error';
                timeValueEl.textContent = 'Error';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            ipInput.focus();
            startRealtimeSpeedTest();
        });
    </script>
</body>
</html>
